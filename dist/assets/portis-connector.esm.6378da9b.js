import{A as p}from"./abstract-connector.esm.29d9a9d6.js";import{s as v}from"./vendor.324ec03c.js";function f(i,d){i.prototype=Object.create(d.prototype),i.prototype.constructor=i,i.__proto__=d}function h(i){if(i===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i}var s={1:"mainnet",3:"ropsten",4:"rinkeby",5:"goerli",42:"kovan",100:"xdai",30:"orchid",31:"orchidTestnet",99:"core",77:"sokol",61:"classic",8:"ubiq",108:"thundercore",18:"thundercoreTestnet",163:"lightstreams",122:"fuse",15001:"maticTestnet"},P=function(i){f(d,i);function d(t){var e,r=t.dAppId,o=t.networks,n=t.config,a=n===void 0?{}:n,l=o.map(function(u){return typeof u=="number"?u:Number(u.chainId)});return l.every(function(u){return!!s[u]})||v(!1),e=i.call(this,{supportedChainIds:l})||this,e.dAppId=r,e.networks=o,e.config=a,e.handleOnLogout=e.handleOnLogout.bind(h(e)),e.handleOnActiveWalletChanged=e.handleOnActiveWalletChanged.bind(h(e)),e.handleOnError=e.handleOnError.bind(h(e)),e}var c=d.prototype;return c.handleOnLogout=function(){this.emitDeactivate()},c.handleOnActiveWalletChanged=function(e){this.emitUpdate({account:e})},c.handleOnError=function(e){this.emitError(e)},c.activate=function(){try{var e=function(){return r.portis.onLogout(r.handleOnLogout),r.portis.onActiveWalletChanged(r.handleOnActiveWalletChanged),r.portis.onError(r.handleOnError),Promise.resolve(r.portis.provider.enable().then(function(a){return a[0]})).then(function(a){return{provider:r.portis.provider,account:a}})},r=this,o=function(){if(!r.portis)return Promise.resolve(import("./index.a1c3db2a.js").then(function(n){var a;return(a=n==null?void 0:n.default)!=null?a:n})).then(function(n){r.portis=new n(r.dAppId,typeof r.networks[0]=="number"?s[r.networks[0]]:r.networks[0],r.config)})}();return Promise.resolve(o&&o.then?o.then(e):e(o))}catch(n){return Promise.reject(n)}},c.getProvider=function(){try{var e=this;return Promise.resolve(e.portis.provider)}catch(r){return Promise.reject(r)}},c.getChainId=function(){try{var e=this;return Promise.resolve(e.portis.provider.send("eth_chainId"))}catch(r){return Promise.reject(r)}},c.getAccount=function(){try{var e=this;return Promise.resolve(e.portis.provider.send("eth_accounts").then(function(r){return r[0]}))}catch(r){return Promise.reject(r)}},c.deactivate=function(){this.portis.onLogout(function(){}),this.portis.onActiveWalletChanged(function(){}),this.portis.onError(function(){})},c.changeNetwork=function(e,r){try{var o=this;return typeof e=="number"?(s[e]||v(!1),o.portis.changeNetwork(s[e],r),o.emitUpdate({chainId:e})):(o.portis.changeNetwork(e,r),o.emitUpdate({chainId:Number(e.chainId)})),Promise.resolve()}catch(n){return Promise.reject(n)}},c.close=function(){try{var e=this;return Promise.resolve(e.portis.logout()).then(function(){e.emitDeactivate()})}catch(r){return Promise.reject(r)}},d}(p);export{P as PortisConnector};
