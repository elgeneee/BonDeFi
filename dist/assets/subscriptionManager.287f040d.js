var Be=Object.defineProperty;var ae=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var ue=(e,r,t)=>r in e?Be(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,ce=(e,r)=>{for(var t in r||(r={}))Se.call(r,t)&&ue(e,t,r[t]);if(ae)for(var t of ae(r))Oe.call(r,t)&&ue(e,t,r[t]);return e};import{u as Ae}from"./immutable.21bf563e.js";import{e as $e}from"./abstract-connector.esm.29d9a9d6.js";import{f as xe,s as D}from"./index.f40f696e.js";import{x as Le,I as Ne,v as j}from"./vendor.324ec03c.js";import{e as Te}from"./index.e3d37b72.js";const ke=Ae,de=$e.exports;var W=typeof Reflect=="object"?Reflect:null,He=W&&typeof W.apply=="function"?W.apply:function(r,t,n){return Function.prototype.apply.call(r,t,n)},dt=G;function G(){de.call(this)}ke.inherits(G,de);G.prototype.emit=function(e){for(var r=[],t=1;t<arguments.length;t++)r.push(arguments[t]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var s;if(r.length>0&&(s=r[0]),s instanceof Error)throw s;var i=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw i.context=s,i}var a=o[e];if(a===void 0)return!1;if(typeof a=="function")le(a,this,r);else for(var u=a.length,d=ze(a,u),t=0;t<u;++t)le(d[t],this,r);return!0};function le(e,r,t){try{He(e,r,t)}catch(n){setTimeout(()=>{throw n})}}function ze(e,r){for(var t=new Array(r),n=0;n<r;++n)t[n]=e[n];return t}var fe={},Q={},K=Le(Ne),$={};Object.defineProperty($,"__esModule",{value:!0});var he=K,qe=function(){function e(r){if(this._maxConcurrency=r,this._queue=[],r<=0)throw new Error("semaphore must be initialized to a positive value");this._value=r}return e.prototype.acquire=function(){var r=this,t=this.isLocked(),n=new Promise(function(o){return r._queue.push(o)});return t||this._dispatch(),n},e.prototype.runExclusive=function(r){return he.__awaiter(this,void 0,void 0,function(){var t,n,o;return he.__generator(this,function(s){switch(s.label){case 0:return[4,this.acquire()];case 1:t=s.sent(),n=t[0],o=t[1],s.label=2;case 2:return s.trys.push([2,,4,5]),[4,r(n)];case 3:return[2,s.sent()];case 4:return o(),[7];case 5:return[2]}})})},e.prototype.isLocked=function(){return this._value<=0},e.prototype.release=function(){if(this._maxConcurrency>1)throw new Error("this method is unavailabel on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){var r=this._currentReleaser;this._currentReleaser=void 0,r()}},e.prototype._dispatch=function(){var r=this,t=this._queue.shift();if(!!t){var n=!1;this._currentReleaser=function(){n||(n=!0,r._value++,r._dispatch())},t([this._value--,this._currentReleaser])}},e}();$.default=qe;Object.defineProperty(Q,"__esModule",{value:!0});var pe=K,Je=$,Ue=function(){function e(){this._semaphore=new Je.default(1)}return e.prototype.acquire=function(){return pe.__awaiter(this,void 0,void 0,function(){var r,t;return pe.__generator(this,function(n){switch(n.label){case 0:return[4,this._semaphore.acquire()];case 1:return r=n.sent(),t=r[1],[2,t]}})})},e.prototype.runExclusive=function(r){return this._semaphore.runExclusive(function(){return r()})},e.prototype.isLocked=function(){return this._semaphore.isLocked()},e.prototype.release=function(){this._semaphore.release()},e}();Q.default=Ue;var x={};Object.defineProperty(x,"__esModule",{value:!0});x.withTimeout=void 0;var L=K;function Ve(e,r,t){var n=this;return t===void 0&&(t=new Error("timeout")),{acquire:function(){return new Promise(function(o,s){return L.__awaiter(n,void 0,void 0,function(){var i,a,u;return L.__generator(this,function(d){switch(d.label){case 0:return i=!1,setTimeout(function(){i=!0,s(t)},r),[4,e.acquire()];case 1:return a=d.sent(),i?(u=Array.isArray(a)?a[1]:a,u()):o(a),[2]}})})})},runExclusive:function(o){return L.__awaiter(this,void 0,void 0,function(){var s,i;return L.__generator(this,function(a){switch(a.label){case 0:s=function(){},a.label=1;case 1:return a.trys.push([1,,7,8]),[4,this.acquire()];case 2:return i=a.sent(),Array.isArray(i)?(s=i[1],[4,o(i[0])]):[3,4];case 3:return[2,a.sent()];case 4:return s=i,[4,o()];case 5:return[2,a.sent()];case 6:return[3,8];case 7:return s(),[7];case 8:return[2]}})})},release:function(){e.release()},isLocked:function(){return e.isLocked()}}}x.withTimeout=Ve;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.withTimeout=e.Semaphore=e.Mutex=void 0;var r=Q;Object.defineProperty(e,"Mutex",{enumerable:!0,get:function(){return r.default}});var t=$;Object.defineProperty(e,"Semaphore",{enumerable:!0,get:function(){return t.default}});var n=x;Object.defineProperty(e,"withTimeout",{enumerable:!0,get:function(){return n.withTimeout}})})(fe);var X={},N={},B={};Object.defineProperty(B,"__esModule",{value:!0});B.getUniqueId=void 0;const me=4294967295;let Y=Math.floor(Math.random()*me);function De(){return Y=(Y+1)%me,Y}B.getUniqueId=De;Object.defineProperty(N,"__esModule",{value:!0});N.createIdRemapMiddleware=void 0;const We=B;function Ge(){return(e,r,t,n)=>{const o=e.id,s=We.getUniqueId();e.id=s,r.id=s,t(i=>{e.id=o,r.id=o,i()})}}N.createIdRemapMiddleware=Ge;var T={};Object.defineProperty(T,"__esModule",{value:!0});T.createAsyncMiddleware=void 0;function Qe(e){return async(r,t,n,o)=>{let s;const i=new Promise(h=>{s=h});let a=null,u=!1;const d=async()=>{u=!0,n(h=>{a=h,s()}),await i};try{await e(r,t,d),u?(await i,a(null)):o(null)}catch(h){a?a(h):o(h)}}}T.createAsyncMiddleware=Qe;var k={};Object.defineProperty(k,"__esModule",{value:!0});k.createScaffoldMiddleware=void 0;function Ke(e){return(r,t,n,o)=>{const s=e[r.method];return s===void 0?n():typeof s=="function"?s(r,t,n,o):(t.result=s,o())}}k.createScaffoldMiddleware=Ke;var S={},ye={},F={};Object.defineProperty(F,"__esModule",{value:!0});F.EthereumProviderError=F.EthereumRpcError=void 0;const Xe=xe;class ge extends Error{constructor(r,t,n){if(!Number.isInteger(r))throw new Error('"code" must be an integer.');if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string.');super(t);this.code=r,n!==void 0&&(this.data=n)}serialize(){const r={code:this.code,message:this.message};return this.data!==void 0&&(r.data=this.data),this.stack&&(r.stack=this.stack),r}toString(){return Xe.default(this.serialize(),er,2)}}F.EthereumRpcError=ge;class Ye extends ge{constructor(r,t,n){if(!Ze(r))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(r,t,n)}}F.EthereumProviderError=Ye;function Ze(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}function er(e,r){if(r!=="[Circular]")return r}var Z={},C={};Object.defineProperty(C,"__esModule",{value:!0});C.errorValues=C.errorCodes=void 0;C.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};C.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},"4001":{standard:"EIP-1193",message:"User rejected the request."},"4100":{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},"4200":{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},"4900":{standard:"EIP-1193",message:"The provider is disconnected from all chains."},"4901":{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.serializeError=e.isValidCode=e.getMessageFromCode=e.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;const r=C,t=F,n=r.errorCodes.rpc.internal,o="Unspecified error message. This is a bug, please report it.",s={code:n,message:i(n)};e.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function i(c,p=o){if(Number.isInteger(c)){const m=c.toString();if(y(r.errorValues,m))return r.errorValues[m].message;if(d(c))return e.JSON_RPC_SERVER_ERROR_MESSAGE}return p}e.getMessageFromCode=i;function a(c){if(!Number.isInteger(c))return!1;const p=c.toString();return!!(r.errorValues[p]||d(c))}e.isValidCode=a;function u(c,{fallbackError:p=s,shouldIncludeStack:m=!1}={}){var R,P;if(!p||!Number.isInteger(p.code)||typeof p.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(c instanceof t.EthereumRpcError)return c.serialize();const g={};if(c&&typeof c=="object"&&!Array.isArray(c)&&y(c,"code")&&a(c.code)){const l=c;g.code=l.code,l.message&&typeof l.message=="string"?(g.message=l.message,y(l,"data")&&(g.data=l.data)):(g.message=i(g.code),g.data={originalError:h(c)})}else{g.code=p.code;const l=(R=c)===null||R===void 0?void 0:R.message;g.message=l&&typeof l=="string"?l:p.message,g.data={originalError:h(c)}}const f=(P=c)===null||P===void 0?void 0:P.stack;return m&&c&&f&&typeof f=="string"&&(g.stack=f),g}e.serializeError=u;function d(c){return c>=-32099&&c<=-32e3}function h(c){return c&&typeof c=="object"&&!Array.isArray(c)?Object.assign({},c):c}function y(c,p){return Object.prototype.hasOwnProperty.call(c,p)}})(Z);var H={};Object.defineProperty(H,"__esModule",{value:!0});H.ethErrors=void 0;const ee=F,we=Z,v=C;H.ethErrors={rpc:{parse:e=>E(v.errorCodes.rpc.parse,e),invalidRequest:e=>E(v.errorCodes.rpc.invalidRequest,e),invalidParams:e=>E(v.errorCodes.rpc.invalidParams,e),methodNotFound:e=>E(v.errorCodes.rpc.methodNotFound,e),internal:e=>E(v.errorCodes.rpc.internal,e),server:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");const{code:r}=e;if(!Number.isInteger(r)||r>-32005||r<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return E(r,e)},invalidInput:e=>E(v.errorCodes.rpc.invalidInput,e),resourceNotFound:e=>E(v.errorCodes.rpc.resourceNotFound,e),resourceUnavailable:e=>E(v.errorCodes.rpc.resourceUnavailable,e),transactionRejected:e=>E(v.errorCodes.rpc.transactionRejected,e),methodNotSupported:e=>E(v.errorCodes.rpc.methodNotSupported,e),limitExceeded:e=>E(v.errorCodes.rpc.limitExceeded,e)},provider:{userRejectedRequest:e=>O(v.errorCodes.provider.userRejectedRequest,e),unauthorized:e=>O(v.errorCodes.provider.unauthorized,e),unsupportedMethod:e=>O(v.errorCodes.provider.unsupportedMethod,e),disconnected:e=>O(v.errorCodes.provider.disconnected,e),chainDisconnected:e=>O(v.errorCodes.provider.chainDisconnected,e),custom:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");const{code:r,message:t,data:n}=e;if(!t||typeof t!="string")throw new Error('"message" must be a nonempty string');return new ee.EthereumProviderError(r,t,n)}}};function E(e,r){const[t,n]=ve(r);return new ee.EthereumRpcError(e,t||we.getMessageFromCode(e),n)}function O(e,r){const[t,n]=ve(r);return new ee.EthereumProviderError(e,t||we.getMessageFromCode(e),n)}function ve(e){if(e){if(typeof e=="string")return[e];if(typeof e=="object"&&!Array.isArray(e)){const{message:r,data:t}=e;if(r&&typeof r!="string")throw new Error("Must specify string message.");return[r||void 0,t]}}return[]}(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getMessageFromCode=e.serializeError=e.EthereumProviderError=e.EthereumRpcError=e.ethErrors=e.errorCodes=void 0;const r=F;Object.defineProperty(e,"EthereumRpcError",{enumerable:!0,get:function(){return r.EthereumRpcError}}),Object.defineProperty(e,"EthereumProviderError",{enumerable:!0,get:function(){return r.EthereumProviderError}});const t=Z;Object.defineProperty(e,"serializeError",{enumerable:!0,get:function(){return t.serializeError}}),Object.defineProperty(e,"getMessageFromCode",{enumerable:!0,get:function(){return t.getMessageFromCode}});const n=H;Object.defineProperty(e,"ethErrors",{enumerable:!0,get:function(){return n.ethErrors}});const o=C;Object.defineProperty(e,"errorCodes",{enumerable:!0,get:function(){return o.errorCodes}})})(ye);var rr=j&&j.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(S,"__esModule",{value:!0});S.JsonRpcEngine=void 0;const tr=rr(D),b=ye;class M extends tr.default{constructor(){super();this._middleware=[]}push(r){this._middleware.push(r)}handle(r,t){if(t&&typeof t!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(r)?t?this._handleBatch(r,t):this._handleBatch(r):t?this._handle(r,t):this._promiseHandle(r)}asMiddleware(){return async(r,t,n,o)=>{try{const[s,i,a]=await M._runAllMiddleware(r,t,this._middleware);return i?(await M._runReturnHandlers(a),o(s)):n(async u=>{try{await M._runReturnHandlers(a)}catch(d){return u(d)}return u()})}catch(s){return o(s)}}}async _handleBatch(r,t){try{const n=await Promise.all(r.map(this._promiseHandle.bind(this)));return t?t(null,n):n}catch(n){if(t)return t(n);throw n}}_promiseHandle(r){return new Promise(t=>{this._handle(r,(n,o)=>{t(o)})})}async _handle(r,t){if(!r||Array.isArray(r)||typeof r!="object"){const i=new b.EthereumRpcError(b.errorCodes.rpc.invalidRequest,`Requests must be plain objects. Received: ${typeof r}`,{request:r});return t(i,{id:void 0,jsonrpc:"2.0",error:i})}if(typeof r.method!="string"){const i=new b.EthereumRpcError(b.errorCodes.rpc.invalidRequest,`Must specify a string method. Received: ${typeof r.method}`,{request:r});return t(i,{id:r.id,jsonrpc:"2.0",error:i})}const n=Object.assign({},r),o={id:n.id,jsonrpc:n.jsonrpc};let s=null;try{await this._processRequest(n,o)}catch(i){s=i}return s&&(delete o.result,o.error||(o.error=b.serializeError(s))),t(s,o)}async _processRequest(r,t){const[n,o,s]=await M._runAllMiddleware(r,t,this._middleware);if(M._checkForCompletion(r,t,o),await M._runReturnHandlers(s),n)throw n}static async _runAllMiddleware(r,t,n){const o=[];let s=null,i=!1;for(const a of n)if([s,i]=await M._runMiddleware(r,t,a,o),i)break;return[s,i,o.reverse()]}static _runMiddleware(r,t,n,o){return new Promise(s=>{const i=u=>{const d=u||t.error;d&&(t.error=b.serializeError(d)),s([d,!0])},a=u=>{t.error?i(t.error):(u&&(typeof u!="function"&&i(new b.EthereumRpcError(b.errorCodes.rpc.internal,`JsonRpcEngine: "next" return handlers must be functions. Received "${typeof u}" for request:
${re(r)}`,{request:r})),o.push(u)),s([null,!1]))};try{n(r,t,a,i)}catch(u){i(u)}})}static async _runReturnHandlers(r){for(const t of r)await new Promise((n,o)=>{t(s=>s?o(s):n())})}static _checkForCompletion(r,t,n){if(!("result"in t)&&!("error"in t))throw new b.EthereumRpcError(b.errorCodes.rpc.internal,`JsonRpcEngine: Response has no error or result for request:
${re(r)}`,{request:r});if(!n)throw new b.EthereumRpcError(b.errorCodes.rpc.internal,`JsonRpcEngine: Nothing ended request:
${re(r)}`,{request:r})}}S.JsonRpcEngine=M;function re(e){return JSON.stringify(e,null,2)}var z={};Object.defineProperty(z,"__esModule",{value:!0});z.mergeMiddleware=void 0;const nr=S;function sr(e){const r=new nr.JsonRpcEngine;return e.forEach(t=>r.push(t)),r.asMiddleware()}z.mergeMiddleware=sr;(function(e){var r=j&&j.__createBinding||(Object.create?function(n,o,s,i){i===void 0&&(i=s),Object.defineProperty(n,i,{enumerable:!0,get:function(){return o[s]}})}:function(n,o,s,i){i===void 0&&(i=s),n[i]=o[s]}),t=j&&j.__exportStar||function(n,o){for(var s in n)s!=="default"&&!Object.prototype.hasOwnProperty.call(o,s)&&r(o,n,s)};Object.defineProperty(e,"__esModule",{value:!0}),t(N,e),t(T,e),t(k,e),t(B,e),t(S,e),t(z,e)})(X);var ir=function(r){return(t,n,o,s)=>{const i=r[t.method];return i===void 0?o():typeof i=="function"?i(t,n,o,s):(n.result=i,s())}},_e=ir;const Ee=(e,r,t,n)=>function(...o){const s=r.promiseModule;return new s((i,a)=>{r.multiArgs?o.push((...d)=>{r.errorFirst?d[0]?a(d):(d.shift(),i(d)):i(d)}):r.errorFirst?o.push((d,h)=>{d?a(d):i(h)}):o.push(i),Reflect.apply(e,this===t?n:this,o)})},be=new WeakMap;var or=(e,r)=>{r=ce({exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise},r);const t=typeof e;if(!(e!==null&&(t==="object"||t==="function")))throw new TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${e===null?"null":t}\``);const n=(i,a)=>{let u=be.get(i);if(u||(u={},be.set(i,u)),a in u)return u[a];const d=m=>typeof m=="string"||typeof a=="symbol"?a===m:m.test(a),h=Reflect.getOwnPropertyDescriptor(i,a),y=h===void 0||h.writable||h.configurable,p=(r.include?r.include.some(d):!r.exclude.some(d))&&y;return u[a]=p,p},o=new WeakMap,s=new Proxy(e,{apply(i,a,u){const d=o.get(i);if(d)return Reflect.apply(d,a,u);const h=r.excludeMain?i:Ee(i,r,s,i);return o.set(i,h),Reflect.apply(h,a,u)},get(i,a){const u=i[a];if(!n(i,a)||u===Function.prototype[a])return u;const d=o.get(u);if(d)return d;if(typeof u=="function"){const h=Ee(u,r,s,i);return o.set(u,h),h}return u}});return s};const ar=D.default;class ur extends ar{constructor(){super();this.updates=[]}async initialize(){}async update(){throw new Error("BaseFilter - no update method specified")}addResults(r){this.updates=this.updates.concat(r),r.forEach(t=>this.emit("update",t))}addInitialResults(r){}getChangesAndClear(){const r=this.updates;return this.updates=[],r}}var te=ur;const cr=te;class dr extends cr{constructor(){super();this.allResults=[]}async update(){throw new Error("BaseFilterWithHistory - no update method specified")}addResults(r){this.allResults=this.allResults.concat(r),super.addResults(r)}addInitialResults(r){this.allResults=this.allResults.concat(r),super.addInitialResults(r)}getAllResults(){return this.allResults}}var lr=dr,A={minBlockRef:fr,maxBlockRef:hr,sortBlockRefs:ne,bnToHex:pr,blockRefIsNumber:mr,hexToInt:q,incrementHexInt:yr,intToHex:Re,unsafeRandomBytes:gr};function fr(...e){return ne(e)[0]}function hr(...e){const r=ne(e);return r[r.length-1]}function ne(e){return e.sort((r,t)=>r==="latest"||t==="earliest"?1:t==="latest"||r==="earliest"?-1:q(r)-q(t))}function pr(e){return"0x"+e.toString(16)}function mr(e){return e&&!["earliest","latest","pending"].includes(e)}function q(e){return e==null?e:Number.parseInt(e,16)}function yr(e){if(e==null)return e;const r=q(e);return Re(r+1)}function Re(e){if(e==null)return e;let r=e.toString(16);return r.length%2&&(r="0"+r),"0x"+r}function gr(e){let r="0x";for(let t=0;t<e;t++)r+=Me(),r+=Me();return r}function Me(){return Math.floor(Math.random()*16).toString(16)}const wr=Te,vr=or,_r=lr,{bnToHex:lt,hexToInt:J,incrementHexInt:Er,minBlockRef:br,blockRefIsNumber:Rr}=A;class Mr extends _r{constructor({provider:r,params:t}){super();this.type="log",this.ethQuery=new wr(r),this.params=Object.assign({fromBlock:"latest",toBlock:"latest",address:void 0,topics:[]},t),this.params.address&&(Array.isArray(this.params.address)||(this.params.address=[this.params.address]),this.params.address=this.params.address.map(n=>n.toLowerCase()))}async initialize({currentBlock:r}){let t=this.params.fromBlock;["latest","pending"].includes(t)&&(t=r),t==="earliest"&&(t="0x0"),this.params.fromBlock=t;const n=br(this.params.toBlock,r),o=Object.assign({},this.params,{toBlock:n}),s=await this._fetchLogs(o);this.addInitialResults(s)}async update({oldBlock:r,newBlock:t}){const n=t;let o;r?o=Er(r):o=t;const s=Object.assign({},this.params,{fromBlock:o,toBlock:n}),a=(await this._fetchLogs(s)).filter(u=>this.matchLog(u));this.addResults(a)}async _fetchLogs(r){return await vr(n=>this.ethQuery.getLogs(r,n))()}matchLog(r){if(J(this.params.fromBlock)>=J(r.blockNumber)||Rr(this.params.toBlock)&&J(this.params.toBlock)<=J(r.blockNumber))return!1;const t=r.address&&r.address.toLowerCase();return this.params.address&&t&&!this.params.address.includes(t)?!1:this.params.topics.every((o,s)=>{let i=r.topics[s];if(!i)return!1;i=i.toLowerCase();let a=Array.isArray(o)?o:[o];return a.includes(null)?!0:(a=a.map(h=>h.toLowerCase()),a.includes(i))})}}var Fr=Mr,se=Cr;async function Cr({provider:e,fromBlock:r,toBlock:t}){r||(r=t);const n=Fe(r),s=Fe(t)-n+1,i=Array(s).fill().map((u,d)=>n+d).map(Pr);return await Promise.all(i.map(u=>jr(e,"eth_getBlockByNumber",[u,!1])))}function Fe(e){return e==null?e:Number.parseInt(e,16)}function Pr(e){if(e==null)return e;const r=e.toString(16);return"0x"+r}function jr(e,r,t){return new Promise((n,o)=>{e.sendAsync({id:1,jsonrpc:"2.0",method:r,params:t},(s,i)=>{if(s)return o(s);n(i.result)})})}const Ir=te,Br=se,{incrementHexInt:Sr}=A;class Or extends Ir{constructor({provider:r,params:t}){super();this.type="block",this.provider=r}async update({oldBlock:r,newBlock:t}){const n=t,o=Sr(r),i=(await Br({provider:this.provider,fromBlock:o,toBlock:n})).map(a=>a.hash);this.addResults(i)}}var Ar=Or;const $r=te,xr=se,{incrementHexInt:Lr}=A;class Nr extends $r{constructor({provider:r}){super();this.type="tx",this.provider=r}async update({oldBlock:r}){const t=r,n=Lr(r),o=await xr({provider:this.provider,fromBlock:n,toBlock:t}),s=[];for(const i of o)s.push(...i.transactions);this.addResults(s)}}var Tr=Nr;const kr=fe.Mutex,{createAsyncMiddleware:Hr}=X,zr=_e,qr=Fr,Jr=Ar,Ur=Tr,{intToHex:Ce,hexToInt:ie}=A;var Vr=Dr;function Dr({blockTracker:e,provider:r}){let t=0,n={};const o=new kr,s=Wr({mutex:o}),i=zr({eth_newFilter:s(oe(u)),eth_newBlockFilter:s(oe(d)),eth_newPendingTransactionFilter:s(oe(h)),eth_uninstallFilter:s(U(p)),eth_getFilterChanges:s(U(y)),eth_getFilterLogs:s(U(c))}),a=async({oldBlock:f,newBlock:l})=>{if(n.length===0)return;const w=await o.acquire();try{await Promise.all(I(n).map(async _=>{try{await _.update({oldBlock:f,newBlock:l})}catch(V){console.error(V)}}))}catch(_){console.error(_)}w()};return i.newLogFilter=u,i.newBlockFilter=d,i.newPendingTransactionFilter=h,i.uninstallFilter=p,i.getFilterChanges=y,i.getFilterLogs=c,i.destroy=()=>{P()},i;async function u(f){const l=new qr({provider:r,params:f});return await m(l),l}async function d(){const f=new Jr({provider:r});return await m(f),f}async function h(){const f=new Ur({provider:r});return await m(f),f}async function y(f){const l=ie(f),w=n[l];if(!w)throw new Error(`No filter for index "${l}"`);return w.getChangesAndClear()}async function c(f){const l=ie(f),w=n[l];if(!w)throw new Error(`No filter for index "${l}"`);return w.type==="log"?results=w.getAllResults():results=[],results}async function p(f){const l=ie(f),w=n[l],_=Boolean(w);return _&&await R(l),_}async function m(f){const l=I(n).length,w=await e.getLatestBlock();await f.initialize({currentBlock:w}),t++,n[t]=f,f.id=t,f.idHex=Ce(t);const _=I(n).length;return g({prevFilterCount:l,newFilterCount:_}),t}async function R(f){const l=I(n).length;delete n[f];const w=I(n).length;g({prevFilterCount:l,newFilterCount:w})}async function P(){const f=I(n).length;n={},g({prevFilterCount:f,newFilterCount:0})}function g({prevFilterCount:f,newFilterCount:l}){if(f===0&&l>0){e.on("sync",a);return}if(f>0&&l===0){e.removeListener("sync",a);return}}}function oe(e){return U(async(...r)=>{const t=await e(...r);return Ce(t.id)})}function U(e){return Hr(async(r,t)=>{const n=await e.apply(null,r.params);t.result=n})}function Wr({mutex:e}){return r=>async(t,n,o,s)=>{(await e.acquire())(),r(t,n,o,s)}}function I(e,r){const t=[];for(let n in e)t.push(e[n]);return t}const Gr=D.default,Qr=_e,{createAsyncMiddleware:Pe}=X,Kr=Vr,{unsafeRandomBytes:Xr,incrementHexInt:Yr}=A,Zr=se;var ft=et;function et({blockTracker:e,provider:r}){const t={},n=Kr({blockTracker:e,provider:r});let o=!1;const s=new Gr,i=Qr({eth_subscribe:Pe(a),eth_unsubscribe:Pe(u)});return i.destroy=h,{events:s,middleware:i};async function a(y,c){if(o)throw new Error("SubscriptionManager - attempting to use after destroying");const p=y.params[0],m=Xr(16);let R;switch(p){case"newHeads":R=P({subId:m});break;case"logs":const f=y.params[1],l=await n.newLogFilter(f);R=g({subId:m,filter:l});break;default:throw new Error(`SubscriptionManager - unsupported subscription type "${p}"`)}t[m]=R,c.result=m;return;function P({subId:f}){const l={type:p,destroy:async()=>{e.removeListener("sync",l.update)},update:async({oldBlock:w,newBlock:_})=>{const V=_,je=Yr(w);(await Zr({provider:r,fromBlock:je,toBlock:V})).map(rt).forEach(Ie=>{d(f,Ie)})}};return e.on("sync",l.update),l}function g({subId:f,filter:l}){return l.on("update",_=>d(f,_)),{type:p,destroy:async()=>await n.uninstallFilter(l.idHex)}}}async function u(y,c){if(o)throw new Error("SubscriptionManager - attempting to use after destroying");const p=y.params[0],m=t[p];if(!m){c.result=!1;return}delete t[p],await m.destroy(),c.result=!0}function d(y,c){s.emit("notification",{jsonrpc:"2.0",method:"eth_subscription",params:{subscription:y,result:c}})}function h(){s.removeAllListeners();for(const y in t)t[y].destroy(),delete t[y];o=!0}}function rt(e){return{hash:e.hash,parentHash:e.parentHash,sha3Uncles:e.sha3Uncles,miner:e.miner,stateRoot:e.stateRoot,transactionsRoot:e.transactionsRoot,receiptsRoot:e.receiptsRoot,logsBloom:e.logsBloom,difficulty:e.difficulty,number:e.number,gasLimit:e.gasLimit,gasUsed:e.gasUsed,nonce:e.nonce,mixHash:e.mixHash,timestamp:e.timestamp,extraData:e.extraData}}export{ft as a,Vr as e,dt as s};
